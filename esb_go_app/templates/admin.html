{{template "layout" .}}

{{define "content"}}
    <h1>{{T "Applications"}}</h1>

    <div class="maintenance-section" style="margin-bottom: 2em; padding: 1em; background-color: #f8f9fa; border-radius: 5px;">
        <h3>{{T "Settings"}}</h3>
        <form action="/admin/settings/update" method="post" style="display: inline-block; margin-right: 20px;">
            <div class="form-group" style="display: flex; align-items: center; gap: 10px;">
                <label for="language">{{T "Language"}}:</label>
                <select name="language" id="language">
                    <option value="en" {{if eq .Settings.language "en"}}selected{{end}}>English</option>
                    <option value="be" {{if eq .Settings.language "be"}}selected{{end}}>Беларуская</option>
                    <option value="ru" {{if eq .Settings.language "ru"}}selected{{end}}>Русский</option>
                </select>
                <button type="submit" class="btn btn-secondary">{{T "Save Settings"}}</button>
            </div>
        </form>
    </div>

    <div class="maintenance-section" style="margin-bottom: 2em; padding: 1em; background-color: #f8f9fa; border-radius: 5px;">
        <h3>{{T "Maintenance"}}</h3>
        <form action="/admin/maintenance" method="post" onsubmit="return confirm('{{T "Are you sure you want to delete all channels that do not belong to any application?"}}');" style="display: inline-block;">
            <input type="hidden" name="action" value="prune_orphaned_channels">
            <button type="submit" class="btn btn-secondary">{{T "Delete 'orphaned' channels"}}</button>
        </form>
        <form action="/admin/maintenance/queues" method="get" style="display: inline-block; margin-left: 10px;">
            <button type="submit" class="btn btn-secondary">{{T "Reconcile RabbitMQ Queues"}}</button>
        </form>
    </div>

    {{if .StatusMessage}}
    <div class="status-message success">{{.StatusMessage}}</div>
    {{end}}
    {{if .ErrorMessage}}
    <div class="status-message error">{{.ErrorMessage}}</div>
    {{end}}

    <h2>{{T "Create New Application"}}</h2>
    <form action="/admin/app/create" method="post" style="margin-bottom: 2em;">
        <div class="form-group">
            <label for="name">{{T "Application Name:"}}</label>
            <input type="text" id="name" name="name" required>
        </div>
        <div class="form-group">
            <button type="submit" class="btn">{{T "Create"}}</button>
        </div>
    </form>

    <h2>{{T "Existing Applications"}}</h2>

    <table>
        <thead>
            <tr>
                <th>{{T "Name"}}</th>
                <th>{{T "Client ID (Name)"}}</th>
                <th>{{T "Actions"}}</th>
            </tr>
        </thead>
        <tbody>
            {{range .Applications}}
            <tr>
                <td><a href="/admin/app/{{.ID}}">{{.Name}}</a></td>
                <td><code>{{.Name}}</code></td>
                <td>
                    <form action="/admin/app/{{.ID}}/delete" method="post" onsubmit="return confirm('{{T "Are you sure you want to delete this application?"}}');">
                        <button type="submit" class="btn btn-danger">{{T "Delete"}}</button>
                    </form>
                </td>
            </tr>
            {{else}}
            <tr>
                <td colspan="3">{{T "No applications created."}}</td>
            </tr>
            {{end}}
        </tbody>
    </table>

    <footer style="margin-top: 3em; padding-top: 1em; border-top: 1px solid #eee; color: #666; font-size: 0.9em;">
        <p>
            {{T "Service version:"}} {{.Version}} |
            {{T "Author:"}} <a href="https://github.com/azheval" target="_blank">Valentin Azharonak</a> |
            <a href="https://github.com/azheval/esb_go_app" target="_blank">{{T "Repository on GitHub"}}</a>
        </p>
    </footer>
{{end}}