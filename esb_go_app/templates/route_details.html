{{define "content"}}
    <a href="/admin/routes">&larr; {{T "Back to route list"}}</a>

    {{if .Route}}
    <h1>{{T "Route:"}} {{.Route.Name}}</h1>
    <p>ID: <code>{{.Route.ID}}</code></p>

    <h2 style="margin-top: 2em;">{{T "Route Details"}}</h2>
    <table>
        <tr>
            <th>{{T "Source"}}</th>
            <td>
                <strong>{{T "Application:"}}</strong> {{.Route.SourceAppName}}<br>
                <strong>{{T "Channel:"}}</strong> {{.Route.SourceChannelName}}<br>
                <small><code>{{.Route.SourceDestination}}</code></small>
            </td>
        </tr>
        <tr>
            <th>{{T "Destination"}}</th>
            <td>
                <strong>{{T "Application:"}}</strong> {{.Route.DestinationAppName}}<br>
                <strong>{{T "Channel:"}}</strong> {{.Route.DestinationChannelName}}<br>
                <small><code>{{.Route.DestinationDestination}}</code></small>
            </td>
        </tr>
        <tr><th>{{T "Type"}}</th><td>{{.Route.RouteType}}</td></tr>
        {{if .Route.TransformationID}}
        <tr>
            <th>{{T "Transformation"}}</th>
            <td>
                <strong>{{T "Name:"}}</strong> {{.Route.TransformationName}}<br>
                <small>ID: <code>{{.Route.TransformationID}}</code></small>
            </td>
        </tr>
        {{end}}
        <tr><th>{{T "Integration"}}</th><td>{{if .Route.IntegrationName}}{{.Route.IntegrationName}}{{else}}N/A{{end}}</td></tr>
        <tr><th>{{T "Created"}}</th><td>{{.Route.CreatedAt.Format "2006-01-02 15:04:05"}}</td></tr>
    </table>

    {{/* Edit Form */}}
    <h2 style="margin-top: 2em;">{{T "Update Route"}}</h2>
    <form action="/admin/routes/{{.Route.ID}}/edit" method="POST">
        <div class="form-group">
            <label for="name">{{T "Route Name:"}}</label>
            <input type="text" id="name" name="name" value="{{.Route.Name}}" required>
        </div>

        <div class="form-group">
            <label for="source_channel_id">{{T "Source Channel:"}}</label>
            <select id="source_channel_id" name="source_channel_id" required>
                {{range .InboundChannels}}
                    <option value="{{.ID}}" {{if eq .ID $.Route.SourceChannelID}}selected{{end}}>{{.ApplicationName}} - {{.Name}} ({{.Destination}})</option>
                {{end}}
                {{range .RouteSources}}
                    <option value="{{.ID}}" {{if eq .ID $.Route.SourceChannelID}}selected{{end}}>{{.Name}}</option>
                {{end}}
            </select>
        </div>

        <div class="form-group">
            <label for="destination_channel_id">{{T "Destination Channel:"}}</label>
            <select id="destination_channel_id" name="destination_channel_id" required>
                {{range .DestinationChannels}}
                    <option value="{{.ID}}" {{if eq .ID $.Route.DestinationChannelID}}selected{{end}}>{{.ApplicationName}} - {{.Name}} ({{.Destination}})</option>
                {{end}}
            </select>
        </div>

        <div class="form-group">
            <label for="route_type">{{T "Route Type"}}:</label>
            <select id="route_type" name="route_type" required onchange="toggleTransformation()">
                <option value="direct" {{if eq .Route.RouteType "direct"}}selected{{end}}>{{T "Direct"}}</option>
                <option value="transform" {{if eq .Route.RouteType "transform"}}selected{{end}}>{{T "With Transformation"}}</option>
            </select>
        </div>

        <div class="form-group" id="transformation-group" {{if ne .Route.RouteType "transform"}}style="display:none;"{{end}}>
            <label for="transformation_id">{{T "Transformation"}}:</label>
            <select id="transformation_id" name="transformation_id">
                <option value="">{{T "-- Select transformation --"}}</option>
                {{range .Transformations}}
                    <option value="{{.ID}}" {{if eq .ID $.Route.TransformationID}}selected{{end}}>{{.Name}}</option>
                {{end}}
            </select>
        </div>

        <div class="form-group">
            <label for="integration_id">{{T "Integration"}}:</label>
            <select id="integration_id" name="integration_id">
                <option value="">{{T "-- No integration --"}}</option>
                {{range .Integrations}}
                    <option value="{{.ID}}" {{if eq .ID $.Route.IntegrationID}}selected{{end}}>{{.Name}}</option>
                {{end}}
            </select>
        </div>

        <button type="submit" class="btn btn-primary">{{T "Update Route"}}</button>
    </form>

    <script>
        function toggleTransformation() {
            var routeType = document.getElementById("route_type").value;
            var transformationGroup = document.getElementById("transformation-group");
            var transformationIdSelect = document.getElementById("transformation_id");

            if (routeType === "direct") {
                transformationGroup.style.display = "none";
                transformationIdSelect.removeAttribute("required");
                transformationIdSelect.value = ""; // Clear selected transformation
            } else {
                transformationGroup.style.display = "block";
                transformationIdSelect.setAttribute("required", "required");
            }
        }
        document.addEventListener('DOMContentLoaded', toggleTransformation); // Call on page load
    </script>

    {{else}}
    <p>{{T "Route not found."}}</p>
    {{end}}
{{end}}